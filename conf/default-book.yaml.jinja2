# Document Metadata
# Essential information about the book for title pages, PDF properties, and indexing.
title: "{{ title | default('Titre par défaut') }}"              # Main title of the book (used in PDF title page and headers).
subtitle: "{{ subtitle | default('Sous-titre par défaut') }}"      # Subtitle (shown under the title).
author: # Author name(s). Use a list for multiple authors.
{%- if author is defined and author %}
{%- for item in author %}
  - "{{ item }}"
{%- endfor %}
{%- else %}
  - "Auteur inconnu"
{% endif %}
date: "{{ date | default('\\today') }}"                   # Publication date. Defaults to the LaTeX command for the current date.

# This field is intended for a concise summary of your book's content, often displayed as an "abstract" section within the document itself, particularly in academic or technical publications.
# Pandoc uses the abstract variable to populate an abstract environment in LaTeX output (if the template supports it) or to generate an abstract section in HTML, EPUB, and DOCX formats.
# It can contain Markdown formatting, which Pandoc will convert to the appropriate output format (e.g., HTML paragraphs for web output).
abstract: |
{% if abstract is defined and abstract %}
  {{ abstract | indent(2) }}
{% else %}
  Résumé par défaut du livre. Ce document est configuré pour une publication professionnelle,
  prenant en charge le contenu multilingue, les caractères Unicode et les emojis,
  ainsi que la conformité PDF/A pour l'archivage.
{% endif %} # Short summary, used in PDF metadata. Use '|' for multi-line strings.

keywords: # List of relevant keywords for indexing and PDF metadata.
{%- if keywords is defined and keywords %}
{%- for item in keywords %}
  - "{{ item }}"
{%- endfor %}
{%- else %}
  - hero
  - fantasy
  - imaginaire
  - multilingual
  - emoji
  - PDF/A
{% endif %}
subject: "{{ subject | default('PSubject of the book') }}" # Document subject for PDF metadata. [2]

# Purpose: This field is generally used for a longer, more detailed description of the document, primarily for metadata purposes in various file formats.
#  Pandoc includes the description in the metadata of ODT, DOCX, and PPTX files. Some applications might display this as "Comments" metadata in the PDF properties.  It is not typically rendered directly within the visible content of the LaTeX PDF document itself, unlike abstract.
description: |
{% if description is defined and description %}
  {{ description | indent(2) }}
{% else %}
  Personalized book
{% endif %} # Longer description for PDF metadata. [2]

# "Fiction", "Non-Fiction", "Science", "History", "Technical Documentation", "Academic Research", etc.
category: "{{ category | default('Fiction') }}"                    # Document category for PDF metadata. [2]
publisher: "{{ publisher | default('Auto-édition') }}"              # Publisher name (used in PDF metadata).
isbn: "{{ isbn | default('') }}"                               # ISBN number (optional, for cataloging).
rights: "{{ rights | default('© 2025 Substantifik. All Rights Reserved.') }}" # Copyright or license info.

# Book outline, populated from project data. This is a placeholder and will be overridden.
outline: |
{%- if outline is defined and outline %}
  {{ outline | indent(2) }}
{%- endif %}

# Language Configuration
# 'lang' identifies the primary language using IETF BCP 47 tags (e.g., en-US, fr-CA).
# This is critical for hyphenation and correct language-specific typesetting with polyglossia.
lang: "{{ lang | default('fr-FR') }}"                            # Primary language of the document. Set to French (France). [2]
dir: ltr                               # Base script direction: 'ltr' for left-to-right (default).
                                       # Important for bidirectional languages like Arabic or Hebrew. [2]

# LaTeX Engine and Document Class
# 'pdf-engine' specifies the LaTeX processor. LuaLaTeX is crucial for advanced features.
pdf-engine: lualatex                   # Essential for robust Unicode, multilingual, and color emoji support. [3, 4]
documentclass: scrbook                 # Recommended document class from KOMA-Script for professional book typesetting. [1]
                                       # Offers superior typography and extensive layout flexibility. [1, 5]
fontsize: 12pt                         # Base font size for the document. Common options: 10pt, 11pt, 12pt. [6, 7]

# Core Book Dimensions for Easy Adjustment (US Trade 6x9 inches with bleed)
# Modify these values to change the book's physical size.
# For US Trade 6x9 (152x229mm):
book-width-core: 6in                   # Core book width (e.g., 6 inches). [1]
book-height-core: 9in                  # Core book height (e.g., 9 inches). [1]
bleed-amount: 0.125in                  # Standard bleed for print (e.g., 0.125 inches on each edge). [1]

smart: true # Converts straight quotes (", ') to curly quotes (“, ”, ‘, ’), three hyphens (---) to em-dashes (—), two hyphens (--) to en-dashes (–), and three dots (...) to ellipses (…). This significantly improves the typography of your document.

# TO CHANGE TO A4 (210x297mm) with 3.175mm bleed:
# book-width-core: 210mm
# book-height-core: 297mm
# bleed-amount: 3.175mm

# Font Configuration (Requires LuaLaTeX and fontspec)
# Using Noto fonts for broad Unicode coverage and visual harmony across scripts is highly recommended. [8, 9, 10]
# Ensure these fonts are installed on your system.
mainfont: "Noto Serif"                 # Primary serif font for body text. [8, 10]

#mainfontoptions:
#  - Ligatures=TeX # Enable standard TeX ligatures
#  - SmallCaps=On # Enable small caps feature
#  - RawFeature=+onum # Enable old-style numerals (if supported by font)

sansfont: "Noto Sans"                  # Sans-serif font for headings, captions, etc. [8, 10]
monofont: "Noto Sans Mono"             # Monospace font for code blocks and fixed-width text. [8, 10]
mathfont: "Latin Modern Math"          # Dedicated font for mathematical expressions. [11]

# Table of Contents and Book Structure
toc: true                              # Generates a Table of Contents. [12]
toc-title: "Table des Matières"        # Title for the TOC. [13]
toc-depth: 3                           # Includes up to subsections (Chapter, Section, Subsection) in the TOC. [13]
toc-own-page: true                     # Ensures the Table of Contents starts on a new page. [12]
titlepage: true                        # Turns on the title page. [12]
book: true                             # Tells Pandoc to use book-specific typesetting features in the LaTeX template. [12]
first-chapter: 1                       # Specifies the starting number for the first chapter. Useful for multi-volume books. [12]

lof: true                              # List of Figures (set true if you have figures/images).
lot: true                              # List of Tables (set true if you have tables).

colorlinks: true                       # Use colored links in PDF (recommended for digital).
linkcolor: "blue"                      # Color for links (e.g., blue, red, etc.). [13]

header-left: "A Book for You"          # Text on the left side of the header. [12]
footer-right: "\\thepage"
#"\\thepage / \\pageref{LastPage}" # Text on the right side of the footer (often page number). [12]

# Cover Image (for title page in PDF)
cover-image-path: "images/my_book_cover.jpg" # Path to your cover image.

# --- LaTeX header-includes ---
# This section allows injecting raw LaTeX code directly into the document's preamble.
# It's used for loading specific packages, defining custom commands, and fine-tuning font fallbacks.
# Note: Pandoc's $header-includes$ might not be at the very end of the preamble.
# If code depends on later declarations, wrap it in \AtEndPreamble from etoolbox. [14]

# LaTeX Header Includes (simplified)
header-includes:
  {% raw %}
  - |
    \usepackage{calc}
    \newcommand{\calculatedPaperWidth}{\dimexpr\book-width-core+\bleed-amount*2\relax}
    \newcommand{\calculatedPaperHeight}{\dimexpr\book-height-core+\bleed-amount*2\relax}
    \usepackage[
      paperwidth=\calculatedPaperWidth, paperheight=\calculatedPaperHeight,
      top=0.75in, bottom=0.75in, inner=0.75in, outer=0.5in,
      includehead, includefoot
    ]{geometry}
  - |
    \usepackage{polyglossia}
    \setotherlanguages{english,german,japanese,arabic,hebrew}
  - |
    \babelfont[japanese]{rm}{Noto Serif CJK JP}
    \babelfont[japanese]{sf}{Noto Sans CJK JP}
    \babelfont[arabic]{rm}{Noto Naskh Arabic}
    \babelfont[hebrew]{rm}{Noto Serif Hebrew}
  - |
    \directlua{luaotfload.add_fallback ("emojifallback", {
      "Noto Color Emoji:mode=harf;", "Segoe UI Emoji:mode=harf;",
    })}
  - \usepackage[a-3u,mathxmp]{pdfx}
  - \usepackage[pdfa]{hyperref}
  - \usepackage[final]{microtype}
  - \usepackage{csquotes}
  - \usepackage{etoolbox}
    \preto\chapter{\cleardoublepage}

  {% endraw %}
